<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js" integrity="sha384-Akqfrbj/HpNVo8k11SXBb6TlBWmXXlYQrCSqEWmyKJe+hDm3Z/B2WVG4smwBkRVm" crossorigin="anonymous"></script>
    <script src="../../../../../static/modal.js" ></script>
    <link rel="stylesheet" href="../../../../../static/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>
<body style="padding: 4rem;">

    <!-- Ask request upon load -->
    <div
        class="load-item-content"
        hx-get="/api/admin/products/list"
        hx-target="#item-list" 
        hx-trigger="load"
    >
    </div>


    <!-- Modal for Creating -->
    <div id="create-modal" class="modal" style="display: flex;">
        <div class="modal-content">
            <div class="header">
                <h1>Create Product</h1>
                <span class="close" onclick="closeCreateModal()">&times;</span>
            </div>
            <!-- hx-target="#response" -->
            <!-- hx-on::after-request="if(event.target === this){ refresh_table_list(); closeCreateModal(); }" -->

            <form 
    hx-ext="form-json"
    hx-trigger="submit"
    hx-post="/dev/debug"
>   
    <div>
        <label for="name">Product name</label>
        <input type="text" name="name" id="name" placeholder="Product name">
    </div>

    <div class="item-list-div">  
        <label>Items</label>
        <div class="item-row" id="0">

            <!-- Search item -->
            <div>
                <input 
                    type="text" 
                    placeholder="Search Product..."
                    hx-get=""
                    hx-target="#item-search-result-0"
                    hx-swap="innerHTML"
                    hx-vals="js:{prefix: this.value}"
                    hx-trigger="input changed delay:500ms"
                    hx-on:afterRequest="console.log('None')"
                >
                <input type="hidden" name="list[0][id]" id="item-id" required>
                <div id="item-search-result-0"></div>
            </div>
            
            <!-- Quantity -->
            <input type="number" name="list[0][quantity]" required value="0">
        </div>                
    </div>

    <button class="add-list-button" type="button" onclick="addItemModal(this.previousElementSibling)">Add Item</button>

    <div class="form-group">
        <label for="status">Status:</label>
        <select id="status" name="status" required>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
        </select>
    </div>
    
    <div>
        <label for="description">Description</label>
        <input type="text" name="description" id="description" placeholder="Description">
    </div>

    <div>
        <label for="price">Price</label><br>
        <input type="number" step="0.01" min="0.00" name="price" id="price" placeholder="0.00" oninput="limitDecimal(this)" style="width: 20%;">
    </div>

    <div>
        <label for="stock">Available Stocks</label><br>
        <input type="number" min="0" name="stock" placeholder="0" id="stock" style="width: 20%;">
    </div>

    <div class="confirm-action">
        <button type="submit">Submit</button>
        <button type="button" onclick="closeCreateModal()">Cancel</button>
    </div>
</form>

            
        </div>
    </div>



    <!-- Modal for Deletion -->
     <div id="delete-modal" class="modal" style="cursor: pointer;">
        <div class="modal-content">
            <div class="header">
                <h1>Delete Product</h1>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>

            <div>
                <p>Are you sure you want to delete "<span id="delete-who"></span>" ?</p>
            </div>

            <div class="warning-action">
                <button type="submit" onclick="">Delete</button>
                <button type="button" onclick="closeDeleteModal()">Cancel</button>
            </div>
        </div>
    </div>


    <h1 class="manage-title">PRODUCTS</h1>


    <div class="item-action">

        <!-- Filter -->
        <div>
            <div class="filter-div">
                <div
                    hx-get="/api/products/list?_____"
                    hx-target="#display-list"
                >Active</div>
                <div>Inactive</div>
                <div>OutOfStock</div>
            </div>
        </div>
        
        <!-- Search Button -->
        <div>
            <div class="search-div">
                <input type="text" 
                    name="prefix"
                    class="custom-input" 
                    placeholder="Search..."
                    hx-get="/api/admin/products/list" 
                    hx-trigger="keyup[key=='Enter']" 
                    hx-target="#item-list" 
                    hx-include=".custom-input"
                    >
                <div hx-get="/api/admin/products/list?" 
                    hx-target="#item-list" 
                    hx-include=".custom-input" 
                ><i class="bi bi-search"></i></div>
            </div>

            <!-- Add Button -->

            <div class="add-button" onclick="openCreateModal('create-modal')">
                <i class="bi bi-plus"></i>
                <span>Add</span>
            </div>

        </div>
    </div>

    <div class="table-container">
    <table class="table-list">
        <thead>
            <tr>
                <th style="width: 13%;">Name</th>
		        <th style="width: 5%;">Status</th>
		        <th style="width: 5%;">Items</th>
                <th style="width: 5%;">Price</th>
                <th style="width: 10%;">Created by</th>
                <th style="width: 10%;">Created at</th>
                <th style="width: 10%;">Edited by</th>
                <th style="width: 10%;">Edited at</th>
                <th style="width: 10%;">Actions</th>
            </tr>
        </thead>
        <tbody class="item-list" id="item-list" hx-swap="innerHtml">
            <tr>
                <!-- <td colspan="8" >
                    <div class="display-list" id="display-list">
                        <div class="empty-list">
                            <div>List is Empty</div>
                        </div>
                    </div>
                </td> -->

                <!-- Sample -->
                <td>Chicharon</td>
                <td> <div class="status-green">Active</div></td>
                <td><div class="item-pop-up"></div></td>
                <td>45.00</td>
                <td>James 0. Samson</td>
                <td>March 55, 2000</td>
                <td>(NULL)</td>
                <td>(NULL)</td>
                <td>
                    <button>Edit</button>
                    <button>Delete</button>
                </td>
            </tr>
            <tr>
                <td>Chicharon</td>
                <td> <div class="status-green">Active</div></td>
                <td><div class="item-pop-up"></div></td>
                <td>45.00</td>
                <td>James 0. Samson</td>
                <td>March 55, 2000</td>
                <td>(NULL)</td>
                <td>(NULL)</td>
                <td>
                    <button>Edit</button>
                    <button>Delete</button>
                </td>
            </tr>
            <tr>
                <td>Chicharon</td>
                <td> <div class="status-green">Active</div></td>
                <td><div class="item-pop-up"></div></td>
                <td>45.00</td>
                <td>James 0. Samson</td>
                <td>March 55, 2000</td>
                <td>(NULL)</td>
                <td>(NULL)</td>
                <td>
                    <button>Edit</button>
                    <button>Delete</button>
                </td>
            </tr>
            <tr>
                <td>Chicharon</td>
                <td> <div class="status-green">Active</div></td>
                <td><div class="item-pop-up"></div></td>
                <td>45.00</td>
                <td>James 0. Samson</td>
                <td>March 55, 2000</td>
                <td>(NULL)</td>
                <td>(NULL)</td>
                <td>
                    <button>Edit</button>
                    <button>Delete</button>
                </td>
            </tr>
        </tbody>
    </table>
    </div>
    
    <div class="pager">
        <div>
            <button> <- </button>
                <input type="number" name="" id="">
            <button> -> </button>
        </div>
    </div>


    
    <script>
        let itemCount = 1;

        function addItem() {
            const container = document.getElementById('items-container');
            const newRow = document.createElement('div');
            newRow.className = 'item-row';
            newRow.id = `item-row-${itemCount}`;
            newRow.innerHTML = `
                <div class="search-container">
                    <input type="text" 
                           class="search-input" 
                           placeholder="Search items..." 
                           oninput="searchItems(${itemCount}, this.value)"
                           hx-get="/api/list"
                           hx-trigger="input changed delay:300ms"
                           hx-target="#search-results-${itemCount}"
                           hx-swap="innerHtml"
                           hx-vals='js:{prefix: this.value}'>
                    <input type="hidden" name="list[${itemCount}][id]" class="item-id" required>
                    <div id="search-results-${itemCount}" class="search-results"></div>
                </div>
                <input type="number" name="list[${itemCount}][quantity]" placeholder="Quantity" min="1" required>
                <button type="button" class="remove-btn" onclick="removeItem(${itemCount})">X</button>
            `;
            container.appendChild(newRow);
            itemCount++;
        }

        function removeItem(index) {
            const row = document.getElementById(`item-row-${index}`);
            if (itemCount > 1) {
                row.remove();
                const rows = document.querySelectorAll('.item-row');
                rows.forEach((row, i) => {
                    row.id = `item-row-${i}`;
                    row.querySelector('.item-id').name = `list[${i}][id]`;
                    row.querySelector('input[type="number"]').name = `list[${i}][quantity]`;
                    row.querySelector('button').setAttribute('onclick', `removeItem(${i})`);
                    row.querySelector('.search-input').setAttribute('oninput', `searchItems(${i}, this.value)`);
                    row.querySelector('.search-results').id = `search-results-${i}`;
                    row.querySelector('.search-input').setAttribute('hx-target', `#search-results-${i}`);
                });
                itemCount--;
            }
        }

        function searchItems(index, value) {
            const resultsDiv = document.getElementById(`search-results-${index}`);
            if (value.trim() === '') {
                resultsDiv.style.display = 'none';
                resultsDiv.innerHTML = '';
                document.querySelector(`#item-row-${index} .item-id`).value = '';
                return;
            }
            resultsDiv.style.display = 'block';
        }

        // Handle item selection from search results
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('search-option')) {
                const index = event.target.dataset.index;
                const id = event.target.dataset.id;
                const name = event.target.textContent;
                const row = document.getElementById(`item-row-${index}`);
                row.querySelector('.search-input').value = name;
                row.querySelector('.item-id').value = id;
                row.querySelector('.search-results').style.display = 'none';
            }
        });

        // Close search results when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.search-container')) {
                document.querySelectorAll('.search-results').forEach(div => {
                    div.style.display = 'none';
                });
            }
        });

        // Update list select options (unchanged)
        document.body.addEventListener('htmx:afterSwap', function(event) {
            if (event.detail.target.id === 'list-options') {
                const select = document.getElementById('list-select');
                select.innerHTML = event.detail.target.innerHTML;
            }
        });
    </script>


    <!-- <style>
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        select, input[type="number"], input[type="text"], button {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .item-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .item-row select, .item-row input {
            flex: 1;
        }
        .remove-btn {
            background-color: #f44336;
            flex: 0 0 40px;
        }
        .remove-btn:hover {
            background-color: #d32f2f;
        }
        #items-container {
            margin-bottom: 15px;
        }
        .search-container {
            position: relative;
        }
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            z-index: 10;
            display: none;
        }
        .search-results option {
            padding: 8px;
            cursor: pointer;
        }
        .search-results option:hover {
            background-color: #f0f0f0;
        }
    </style> -->

</body>

